<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Home</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body th:replace="~{layout :: bodyContent}">
<div th:fragment="content">
    <div class="box">
        <div class="dashboard" th:unless="${isAdmin}">
            <h2>Welcome, <span th:text="${currentUser.username}">User</span>!</h2>

            <div class="summary-grid">
                <div class="summary-card">
                    <h4>Total Tasks</h4>
                    <p th:text="${stats.total}">0</p>
                </div>
                <div class="summary-card">
                    <h4>Completed</h4>
                    <p th:text="${stats.completed}">0</p>
                </div>
                <div class="summary-card">
                    <h4>In Progress</h4>
                    <p th:text="${stats.inProgress}">0</p>
                </div>
                <div class="summary-card">
                    <h4>Expired</h4>
                    <p th:text="${stats.expired}">0</p>
                </div>
            </div>

            <div class="progress-bar-container">
                <label>Task Completion Progress</label>
                <progress th:value="${stats.completed}" th:max="${stats.total}">0%</progress>
                <span th:text="${(stats.total > 0) ? (stats.completed * 100 / stats.total) + '%' : '0%'}">0%</span>
            </div>

            <div class="datagrid">
                <h3>Tasks Due Today</h3>
                <table>
                    <thead>
                    <tr>
                        <th>Task</th>
                        <th>Priority</th>
                        <th>Due Time</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="task : ${todayTasks}">
                        <td th:text="${task.label}"></td>
                        <td th:text="${task.priority}"></td>
                        <td th:text="${task.formattedDueTime}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="datagrid" th:if="${overdueTasks.size() > 0}">
                <h3 style="color:red;">⚠️ Overdue Tasks</h3>
                <table>
                    <thead>
                    <tr>
                        <th>Task</th>
                        <th>Due Date</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="task : ${overdueTasks}">
                        <td th:text="${task.label}"></td>
                        <td th:text="${task.formattedDueDate}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/js/modal.js}"></script>
</body>
</html>
